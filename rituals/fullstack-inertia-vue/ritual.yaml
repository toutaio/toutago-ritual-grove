name: fullstack-inertia-vue
description: Full-stack web application with Inertia.js and Vue 3
version: 1.0.0
author: Toutago Team

prompts:
  - name: project_name
    description: Project name
    type: string
    required: true
    validation: "^[a-z][a-z0-9-]*$"

  - name: module_path
    description: Go module path (e.g., github.com/user/project)
    type: string
    required: true

  - name: db_driver
    description: Database driver
    type: select
    options:
      - postgres
      - mysql
    default: postgres

  - name: port
    description: Server port
    type: string
    default: "8080"
    validation: "^[0-9]+$"

  - name: use_auth
    description: Include authentication
    type: boolean
    default: true

  - name: use_ssr
    description: Enable Server-Side Rendering
    type: boolean
    default: false

  - name: enable_docker
    description: Enable Docker support
    type: boolean
    default: true

hooks:
  pre_generation:
    - task: validate-go
      config:
        min_version: "1.21"

  post_generation:
    - task: go-mod-init
      config:
        module: "{{.module_path}}"

    - task: go-get
      config:
        packages:
          - github.com/toutaio/toutago
          - github.com/toutaio/toutago-cosan-router
          - github.com/toutaio/toutago-inertia
          - github.com/toutaio/toutago-datamapper
          - github.com/toutaio/toutago-nasc-dependency-injector
          - "{{if eq .db_driver \"postgres\"}}github.com/lib/pq{{else}}github.com/go-sql-driver/mysql{{end}}"

    - task: directory-create
      config:
        path: "frontend"

    - task: directory-create
      config:
        path: "frontend/pages"

    - task: directory-create
      config:
        path: "frontend/components"

    - task: directory-create
      config:
        path: "frontend/layouts"

    - task: directory-create
      config:
        path: "public"

    - task: directory-create
      config:
        path: "public/dist"

    - task: npm-init
      config:
        working_dir: "."
        package_name: "{{.project_name}}"

    - task: npm-install
      config:
        working_dir: "."
        packages:
          - "@toutaio/inertia-vue@^0.2.0"
          - "vue@^3.4.0"
          - "@vitejs/plugin-vue@^5.0.0"
          - "vite@^5.0.0"
          - "typescript@^5.3.0"
        dev: true

    - task: template-render
      config:
        source: "main.go.tmpl"
        destination: "main.go"

    - task: template-render
      config:
        source: "frontend/app.js.tmpl"
        destination: "frontend/app.js"

    - task: template-render
      config:
        source: "frontend/pages/Home.vue.tmpl"
        destination: "frontend/pages/Home.vue"

    - task: template-render
      config:
        source: "frontend/layouts/Default.vue.tmpl"
        destination: "frontend/layouts/Default.vue"

    - task: template-render
      config:
        source: "vite.config.js.tmpl"
        destination: "vite.config.js"

    - task: template-render
      config:
        source: "tsconfig.json.tmpl"
        destination: "tsconfig.json"

    - task: template-render
      config:
        source: ".env.tmpl"
        destination: ".env"

    - task: template-render
      config:
        source: "_shared:docker/Dockerfile.go.tmpl"
        destination: "Dockerfile"
      condition: "{{.enable_docker}}"

    - task: template-render
      config:
        source: "_shared:docker/docker-compose.yml.tmpl"
        destination: "docker-compose.yml"
      condition: "{{.enable_docker}}"

    - task: template-render
      config:
        source: "_shared:docker/.dockerignore.tmpl"
        destination: ".dockerignore"
      condition: "{{.enable_docker}}"

    - task: template-render
      config:
        source: "_shared:docker/.air.toml.tmpl"
        destination: ".air.toml"
      condition: "{{.enable_docker}}"

    - task: template-render
      config:
        source: "_shared:docs/DOCKER.md.tmpl"
        destination: "DOCKER.md"
      condition: "{{.enable_docker}}"

    - task: file-copy
      config:
        source: "_shared:docker/wait-for-it.sh"
        destination: "wait-for-it.sh"
      condition: "{{.enable_docker}}"

    - task: env-set
      config:
        file: ".env"
        key: "PORT"
        value: "{{.port}}"

    - task: env-set
      config:
        file: ".env"
        key: "DB_DRIVER"
        value: "{{.db_driver}}"

    - task: go-mod-tidy

    - task: npm-install
      config:
        working_dir: "."

    - task: npm-build
      config:
        working_dir: "."
        script: "build"
