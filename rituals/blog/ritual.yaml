ritual:
  name: blog
  version: 1.0.0
  description: A full-featured blog with posts, comments, and categories
  author: ToutÄ Team
  license: MIT
  tags:
    - blog
    - content
    - cms

compatibility:
  min_touta_version: "0.1.0"
  go_version: ">=1.21"

dependencies:
  packages:
    - github.com/toutaio/toutago-cosan-router
    - github.com/toutaio/toutago-fith-renderer
    - github.com/toutaio/toutago-datamapper
    - github.com/toutaio/toutago-nasc-dependency-injector
    - github.com/toutaio/toutago-inertia

questions:
  - name: app_name
    type: text
    prompt: "What is your blog name?"
    default: "My Blog"
    required: true
    validate:
      min_len: 1
      max_len: 100

  - name: module_path
    type: text
    prompt: "What is your Go module path (e.g., github.com/user/myblog)?"
    default: "example.com/myblog"
    required: true
    validate:
      pattern: "^[a-z0-9._/-]+$"

  - name: port
    type: number
    prompt: "Which port should the blog run on?"
    default: 8080
    required: true
    validate:
      min: 1024
      max: 65535

  - name: database_type
    type: choice
    prompt: "Select database type:"
    choices:
      - postgres
      - mysql
    default: postgres
    required: true

  - name: db_host
    type: text
    prompt: "Database host:"
    default: "localhost"
    required: true

  - name: db_port
    type: number
    prompt: "Database port:"
    default: 5432
    required: true
    condition:
      field: database_type
      equals: postgres

  - name: db_port_mysql
    type: number
    prompt: "Database port:"
    default: 3306
    required: true
    condition:
      field: database_type
      equals: mysql

  - name: db_name
    type: text
    prompt: "Database name:"
    default: "blog_db"
    required: true
    validate:
      pattern: "^[a-zA-Z0-9_]+$"

  - name: db_user
    type: text
    prompt: "Database user:"
    default: "blog_user"
    required: true

  - name: db_password
    type: password
    prompt: "Database password:"
    required: true

  - name: enable_comments
    type: boolean
    prompt: "Enable comments on posts?"
    default: true

  - name: posts_per_page
    type: number
    prompt: "How many posts per page?"
    default: 10
    validate:
      min: 1
      max: 100

  - name: enable_markdown
    type: boolean
    prompt: "Enable Markdown support for posts?"
    default: true

  - name: frontend_type
    type: choice
    prompt: "Select frontend framework:"
    choices:
      - traditional
      - inertia-vue
      - htmx
    default: traditional
    required: true

  - name: enable_ssr
    type: boolean
    prompt: "Enable Server-Side Rendering (SSR)?"
    default: false
    condition:
      field: frontend_type
      equals: inertia-vue

  - name: enable_docker
    type: boolean
    prompt: "Enable Docker support?"
    default: true

files:
  templates:
    - src: main.go.tmpl
      dest: main.go

    - src: go.mod.tmpl
      dest: go.mod

    - src: models/post.go.tmpl
      dest: internal/models/post.go

    - src: models/category.go.tmpl
      dest: internal/models/category.go

    - src: models/comment.go.tmpl
      dest: internal/models/comment.go
      condition: "enable_comments == true"

    - src: handlers/home.go.tmpl
      dest: internal/handlers/home.go

    - src: handlers/post.go.tmpl
      dest: internal/handlers/post.go

    - src: handlers/category.go.tmpl
      dest: internal/handlers/category.go

    - src: handlers/comment.go.tmpl
      dest: internal/handlers/comment.go
      condition: "enable_comments == true"

    # Admin handlers
    - src: handlers/admin/user_handler.go.tmpl
      dest: internal/handlers/admin/user_handler.go

    - src: handlers/admin/user_handler_test.go.tmpl
      dest: internal/handlers/admin/user_handler_test.go

    # Post handler with tests
    - src: handlers/post_handler_test.go.tmpl
      dest: internal/handlers/post_handler_test.go

    - src: internal/inertia_adapter.go.tmpl
      dest: internal/inertia_adapter.go

    # Admin views
    - src: views/admin/users/list.html.tmpl
      dest: views/admin/users/list.html
      condition: "[[ ne .frontend_type \"inertia-vue\" ]]"

    - src: views/admin/users/edit.html.tmpl
      dest: views/admin/users/edit.html
      condition: "[[ ne .frontend_type \"inertia-vue\" ]]"

    - src: views/layout.html.tmpl
      dest: views/layout.html
      condition: "[[ ne .frontend_type \"inertia-vue\" ]]"

    - src: views/post_list.html.tmpl
      dest: views/post_list.html
      condition: "[[ ne .frontend_type \"inertia-vue\" ]]"

    - src: views/post_detail.html.tmpl
      dest: views/post_detail.html
      condition: "[[ ne .frontend_type \"inertia-vue\" ]]"

    - src: views/category_list.html.tmpl
      dest: views/category_list.html
      condition: "[[ ne .frontend_type \"inertia-vue\" ]]"

    # Inertia.js frontend files
    - src: templates/app.html.tmpl
      dest: templates/app.html
      condition: "[[ eq .frontend_type \"inertia-vue\" ]]"

    - src: frontend/inertia/app.js.tmpl
      dest: frontend/app.js
      condition: "[[ eq .frontend_type \"inertia-vue\" ]]"

    - src: frontend/inertia/esbuild.config.js.tmpl
      dest: esbuild.config.js
      condition: "[[ eq .frontend_type \"inertia-vue\" ]]"

    - src: frontend/inertia/package.json.tmpl
      dest: package.json
      condition: "[[ eq .frontend_type \"inertia-vue\" ]]"

    - src: frontend/inertia/pages/Home.vue.tmpl
      dest: frontend/pages/Home.vue
      condition: "[[ eq .frontend_type \"inertia-vue\" ]]"

    - src: frontend/inertia/pages/Posts/Index.vue.tmpl
      dest: frontend/pages/Posts/Index.vue
      condition: "[[ eq .frontend_type \"inertia-vue\" ]]"

    - src: frontend/inertia/pages/Posts/Show.vue.tmpl
      dest: frontend/pages/Posts/Show.vue
      condition: "[[ eq .frontend_type \"inertia-vue\" ]]"

    - src: frontend/inertia/pages/Posts/Edit.vue.tmpl
      dest: frontend/pages/Posts/Edit.vue
      condition: "[[ eq .frontend_type \"inertia-vue\" ]]"

    - src: frontend/inertia/pages/Categories/Index.vue.tmpl
      dest: frontend/pages/Categories/Index.vue
      condition: "[[ eq .frontend_type \"inertia-vue\" ]]"

    - src: frontend/inertia/pages/Categories/Show.vue.tmpl
      dest: frontend/pages/Categories/Show.vue
      condition: "[[ eq .frontend_type \"inertia-vue\" ]]"

    - src: frontend/inertia/components/Layout.vue.tmpl
      dest: frontend/components/Layout.vue
      condition: "[[ eq .frontend_type \"inertia-vue\" ]]"

    - src: frontend/inertia/components/Header.vue.tmpl
      dest: frontend/components/Header.vue
      condition: "[[ eq .frontend_type \"inertia-vue\" ]]"

    - src: frontend/inertia/components/Footer.vue.tmpl
      dest: frontend/components/Footer.vue
      condition: "[[ eq .frontend_type \"inertia-vue\" ]]"

    # HTMX frontend files
    - src: frontend/htmx/app.js.tmpl
      dest: frontend/app.js
      condition: "[[ eq .frontend_type \"htmx\" ]]"

    - src: frontend/htmx/esbuild.config.js.tmpl
      dest: esbuild.config.js
      condition: "[[ eq .frontend_type \"htmx\" ]]"

    - src: frontend/htmx/package.json.tmpl
      dest: package.json
      condition: "[[ eq .frontend_type \"htmx\" ]]"

    - src: views/htmx/layout.html.tmpl
      dest: views/layout.html
      condition: "[[ eq .frontend_type \"htmx\" ]]"

    - src: .env.example.tmpl
      dest: .env.example

    - src: README.md.tmpl
      dest: README.md

    # Docker support files (conditional)
    - src: _shared:docker/Dockerfile.go.tmpl
      dest: Dockerfile
      condition: "enable_docker"
    
    - src: _shared:docker/docker-compose.yml.tmpl
      dest: docker-compose.yml
      condition: "enable_docker"
    
    - src: _shared:docker/.dockerignore.tmpl
      dest: .dockerignore
      condition: "enable_docker"
    
    - src: _shared:docker/.air.toml.tmpl
      dest: .air.toml
      condition: "enable_docker"
    
    - src: _shared:docker/.env.example.tmpl
      dest: .env.docker.example
      condition: "enable_docker"
    
    # Create ready-to-use .env file with user's answers
    - src: _shared:docker/.env.example.tmpl
      dest: .env
      condition: "enable_docker"
    
    - src: _shared:docs/DOCKER.md.tmpl
      dest: DOCKER.md
      condition: "enable_docker"
    
    - src: _shared:docs/DATABASE.md.tmpl
      dest: DATABASE.md
      condition: "[[ and (eq .enable_docker true) .database_type ]]"

  static:
    - src: style.css
      dest: public/css/style.css
    
    - src: _shared:docker/wait-for-it.sh
      dest: wait-for-it.sh
      condition: "enable_docker"

migrations:
  - from_version: "0.0.0"
    to_version: "1.0.0"
    description: "Initial schema with posts, categories, and comments"
    up:
      sql:
        - "CREATE TABLE IF NOT EXISTS posts (...)"
      script: "migrations/001_initial_schema.sql"
    down:
      sql:
        - "DROP TABLE IF EXISTS comments"
        - "DROP TABLE IF EXISTS posts"  
        - "DROP TABLE IF NOT EXISTS categories"
      script: "migrations/001_initial_schema_down.sql"

hooks:
  post_install:
    - "go mod tidy"
