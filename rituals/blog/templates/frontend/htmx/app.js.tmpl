// HTMX App - {{ .AppName }}
import htmx from 'htmx.org';

// Initialize HTMX
window.htmx = htmx;

// Configure HTMX
htmx.config.defaultSwapStyle = 'innerHTML';
htmx.config.defaultSwapDelay = 0;
htmx.config.defaultSettleDelay = 20;

// Global error handler
document.body.addEventListener('htmx:responseError', function(evt) {
    console.error('HTMX Error:', evt.detail);
    alert('An error occurred. Please try again.');
});

// Loading indicator
document.body.addEventListener('htmx:beforeRequest', function(evt) {
    const indicator = document.getElementById('loading-indicator');
    if (indicator) {
        indicator.style.display = 'block';
    }
});

document.body.addEventListener('htmx:afterRequest', function(evt) {
    const indicator = document.getElementById('loading-indicator');
    if (indicator) {
        indicator.style.display = 'none';
    }
});

// Success messages
document.body.addEventListener('htmx:afterSwap', function(evt) {
    if (evt.detail.successful) {
        const message = evt.detail.xhr.getResponseHeader('X-Success-Message');
        if (message) {
            showNotification(message, 'success');
        }
    }
});

function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.textContent = message;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 1.5rem;
        background: ${type === 'success' ? '#10b981' : '#3b82f6'};
        color: white;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        z-index: 1000;
        animation: slideIn 0.3s ease-out;
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-out';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// Form validation
document.body.addEventListener('htmx:beforeRequest', function(evt) {
    if (evt.detail.elt.tagName === 'FORM') {
        const form = evt.detail.elt;
        if (!form.checkValidity()) {
            evt.preventDefault();
            form.reportValidity();
        }
    }
});

console.log('HTMX app initialized');
