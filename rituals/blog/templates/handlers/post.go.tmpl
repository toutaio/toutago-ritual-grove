package handlers

import (
"[[ .module_path ]]/internal/models"
"github.com/toutaio/toutago-cosan-router"
nasc "github.com/toutaio/toutago-nasc-dependency-injector"
[[ if eq .frontend_type "inertia-vue" -]]
"github.com/toutaio/toutago-inertia/pkg/inertia"
[[ end -]]
)

// PostHandler handles blog post operations
type PostHandler struct {
container *nasc.Nasc
[[ if eq .frontend_type "inertia-vue" -]]
inertia *inertia.Inertia
[[ end -]]
}

// NewPostHandler creates a new post handler
func NewPostHandler(container *nasc.Nasc[[ if eq .frontend_type "inertia-vue" ]], inertiaInstance *inertia.Inertia[[ end ]]) *PostHandler {
return &PostHandler{
container: container,
[[ if eq .frontend_type "inertia-vue" -]]
inertia: inertiaInstance,
[[ end -]]
}
}

// List shows all posts
func (h *PostHandler) List(c cosan.Context) error {
// TODO: Implement pagination
posts := []models.Post{
// Mock data for now
}

[[ if eq .frontend_type "inertia-vue" -]]
return h.inertia.Render(c.Response(), c.Request(), "Posts/Index", map[string]interface{}{
"posts": posts,
})
[[ else -]]
return c.JSON(200, posts)
[[ end -]]
}

// Show displays a single post
func (h *PostHandler) Show(c cosan.Context) error {
// TODO: Fetch post from database
id := c.Param("id")

post := models.Post{
// Mock data for now
}
_ = id // Use id when implementing

[[ if eq .frontend_type "inertia-vue" -]]
return h.inertia.Render(c.Response(), c.Request(), "Posts/Show", map[string]interface{}{
"post": post,
})
[[ else -]]
return c.JSON(200, post)
[[ end -]]
}

// Create creates a new post
func (h *PostHandler) Create(c cosan.Context) error {
var post models.Post
if err := c.Bind(&post); err != nil {
return c.JSON(400, map[string]string{"error": "Invalid request"})
}

// TODO: Save to database
[[ if eq .frontend_type "inertia-vue" -]]
// Redirect back to posts list after creation
return h.inertia.Location(c.Response(), "/posts")
[[ else -]]
return c.JSON(201, post)
[[ end -]]
}

// Update updates an existing post
func (h *PostHandler) Update(c cosan.Context) error {
id := c.Param("id")
var post models.Post
if err := c.Bind(&post); err != nil {
return c.JSON(400, map[string]string{"error": "Invalid request"})
}

// TODO: Update in database
_ = id // Use id when implementing
[[ if eq .frontend_type "inertia-vue" -]]
// Redirect back to post detail after update
return h.inertia.Location(c.Response(), "/posts/" + id)
[[ else -]]
return c.JSON(200, post)
[[ end -]]
}

// Delete deletes a post
func (h *PostHandler) Delete(c cosan.Context) error {
id := c.Param("id")

// TODO: Delete from database
_ = id // Use id when implementing
[[ if eq .frontend_type "inertia-vue" -]]
// Redirect back to posts list after deletion
return h.inertia.Location(c.Response(), "/posts")
[[ else -]]
return c.JSON(204, nil)
[[ end -]]
}
