<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Library - [[ .app_name ]] Admin</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
            background: #f7fafc;
            cursor: pointer;
            transition: all 0.3s;
        }
        .upload-area:hover {
            border-color: #4299e1;
            background: #ebf8ff;
        }
        .upload-area.dragover {
            border-color: #3182ce;
            background: #bee3f8;
        }
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }
        .media-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .media-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .media-thumbnail {
            width: 100%;
            height: 150px;
            object-fit: cover;
            background: #f7fafc;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .media-thumbnail img {
            max-width: 100%;
            max-height: 100%;
        }
        .media-info {
            padding: 0.75rem;
        }
        .media-name {
            font-size: 0.875rem;
            font-weight: 500;
            color: #2d3748;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .media-size {
            font-size: 0.75rem;
            color: #718096;
            margin-top: 0.25rem;
        }
        .media-actions {
            padding: 0.5rem 0.75rem;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 0.5rem;
        }
        .btn-small {
            flex: 1;
            padding: 0.375rem;
            font-size: 0.75rem;
            border: none;
            border-radius: 0.25rem;
            cursor: pointer;
        }
        .btn-delete {
            background: #f56565;
            color: white;
        }
        .btn-copy {
            background: #4299e1;
            color: white;
        }
        .stats-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .stat-card {
            flex: 1;
            background: white;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #e2e8f0;
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2d3748;
        }
        .stat-label {
            font-size: 0.875rem;
            color: #718096;
            margin-top: 0.25rem;
        }
    </style>
</head>
<body>
    <div class="admin-layout">
        <nav class="admin-sidebar">
            <h2>[[ .app_name ]]</h2>
            <ul>
                <li><a href="/admin/dashboard">Dashboard</a></li>
                <li><a href="/admin/posts">Posts</a></li>
                <li><a href="/admin/categories">Categories</a></li>
                <li><a href="/admin/tags">Tags</a></li>
                <li><a href="/admin/media" class="active">Media</a></li>
                [[ if (Can .user "user.manage" nil) ]]
                <li><a href="/admin/users">Users</a></li>
                [[ end ]]
            </ul>
        </nav>

        <main class="admin-content">
            <header class="admin-header">
                <h1>Media Library</h1>
                <p>Upload and manage your media files</p>
            </header>

            [[ if .stats ]]
            <div class="stats-bar">
                <div class="stat-card">
                    <div class="stat-value">[[ .stats.total ]]</div>
                    <div class="stat-label">Total Files</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">[[ .stats.images ]]</div>
                    <div class="stat-label">Images</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">[[ .stats.videos ]]</div>
                    <div class="stat-label">Videos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">[[ .stats.documents ]]</div>
                    <div class="stat-label">Documents</div>
                </div>
            </div>
            [[ end ]]

            <div class="upload-area" id="uploadArea">
                <input type="file" id="fileInput" multiple style="display: none" accept="image/*,video/*,.pdf,.doc,.docx">
                <p style="margin: 0; font-size: 1.125rem; color: #4a5568;">
                    Click or drag files here to upload
                </p>
                <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem; color: #718096;">
                    Max file size: 10MB
                </p>
            </div>

            <div class="media-grid" id="mediaGrid">
                [[ range .media ]]
                <div class="media-card" data-id="[[ .ID ]]">
                    <div class="media-thumbnail">
                        [[ if eq .Type "image" ]]
                        <img src="[[ .URL ]]" alt="[[ .OriginalName ]]">
                        [[ else ]]
                        <div style="font-size: 3rem; color: #cbd5e0;">ðŸ“„</div>
                        [[ end ]]
                    </div>
                    <div class="media-info">
                        <div class="media-name" title="[[ .OriginalName ]]">[[ .OriginalName ]]</div>
                        <div class="media-size">[[ printf "%.2f KB" (div .Size 1024.0) ]]</div>
                    </div>
                    <div class="media-actions">
                        <button class="btn-small btn-copy" onclick="copyURL('[[ .URL ]]')">Copy URL</button>
                        <button class="btn-small btn-delete" onclick="deleteMedia('[[ .ID ]]', '[[ .OriginalName ]]')">Delete</button>
                    </div>
                </div>
                [[ end ]]
            </div>

            [[ if not .media ]]
            <div style="text-align: center; padding: 3rem; color: #718096;">
                <p>No media files yet. Upload your first file above!</p>
            </div>
            [[ end ]]
        </main>
    </div>

    <script>
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        // Click to upload
        uploadArea.addEventListener('click', () => fileInput.click());

        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            uploadFiles(files);
        });

        // File input change
        fileInput.addEventListener('change', (e) => {
            uploadFiles(e.target.files);
        });

        function uploadFiles(files) {
            Array.from(files).forEach(file => {
                const formData = new FormData();
                formData.append('file', file);

                fetch('/admin/media', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert('Upload failed: ' + data.error);
                    } else {
                        location.reload();
                    }
                })
                .catch(error => {
                    alert('Upload failed: ' + error.message);
                });
            });
        }

        function copyURL(url) {
            navigator.clipboard.writeText(url).then(() => {
                alert('URL copied to clipboard!');
            });
        }

        function deleteMedia(id, name) {
            if (confirm(`Delete "${name}"?`)) {
                fetch(`/admin/media/${id}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert('Delete failed: ' + data.error);
                    } else {
                        location.reload();
                    }
                })
                .catch(error => {
                    alert('Delete failed: ' + error.message);
                });
            }
        }
    </script>
</body>
</html>
