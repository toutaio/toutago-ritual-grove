[[ define "content" ]]
<div class="posts">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h2>Recent Posts</h2>
        {{if can .current_user "create" "posts"}}
        <a href="/admin/posts/new" class="btn btn-primary">Create New Post</a>
        {{end}}
    </div>

    [[ range .Posts ]]
    <article class="post-summary">
        <h3><a href="/posts/[[ .Slug ]]">[[ .Title ]]</a></h3>
        <div class="post-meta">
            <span class="date">[[ .PublishedAt.Format "Jan 2, 2006" ]]</span>
            {{if .Category}}
            <span class="category">[[ .Category.Name ]]</span>
            {{end}}
            <span class="author">by [[ .Author.Name ]]</span>
            {{if ne .Status "published"}}
            <span class="status status-[[ .Status ]]">[[ .Status ]]</span>
            {{end}}
        </div>
        <p>[[ .Excerpt ]]</p>
        <div style="display: flex; gap: 1rem; align-items: center;">
            <a href="/posts/[[ .Slug ]]" class="read-more">Read more &rarr;</a>
            {{if canEdit $.current_user "posts" .AuthorID}}
            <a href="/admin/posts/[[ .ID ]]/edit" class="btn-small btn-edit">Edit</a>
            {{end}}
            {{if canDelete $.current_user "posts" .AuthorID}}
            <button onclick="deletePost([[ .ID ]])" class="btn-small btn-delete">Delete</button>
            {{end}}
        </div>
    </article>
    [[ end ]]

    {{if gt .total_pages 1}}
    <div class="pagination">
        {{if gt .page 1}}
        <a href="?page={{sub .page 1}}">&laquo; Previous</a>
        {{end}}
        
        <span>Page {{.page}} of {{.total_pages}}</span>
        
        {{if lt .page .total_pages}}
        <a href="?page={{add .page 1}}">Next &raquo;</a>
        {{end}}
    </div>
    {{end}}
</div>

<style>
.btn {
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 4px;
    text-decoration: none;
    font-weight: 500;
    cursor: pointer;
}
.btn-primary {
    background: #007bff;
    color: white;
}
.btn-primary:hover {
    background: #0056b3;
}
.btn-small {
    padding: 0.25rem 0.75rem;
    font-size: 0.875rem;
}
.btn-edit {
    background: #28a745;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}
.btn-edit:hover {
    background: #218838;
}
.btn-delete {
    background: #dc3545;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}
.btn-delete:hover {
    background: #c82333;
}
.status {
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}
.status-draft {
    background: #ffc107;
    color: #000;
}
.status-archived {
    background: #6c757d;
    color: white;
}
.pagination {
    display: flex;
    gap: 1rem;
    justify-content: center;
    align-items: center;
    margin-top: 2rem;
    padding: 1rem;
}
.pagination a {
    padding: 0.5rem 1rem;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    text-decoration: none;
    color: #007bff;
}
.pagination a:hover {
    background: #e9ecef;
}
</style>

<script>
function deletePost(id) {
    if (!confirm('Are you sure you want to delete this post?')) {
        return;
    }
    
    fetch(`/api/posts/${id}`, {
        method: 'DELETE',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => {
        if (response.ok) {
            window.location.reload();
        } else {
            return response.json().then(data => {
                alert('Error: ' + (data.error || 'Failed to delete post'));
            });
        }
    })
    .catch(error => {
        alert('Error: ' + error.message);
    });
}
</script>
[[ end ]]
