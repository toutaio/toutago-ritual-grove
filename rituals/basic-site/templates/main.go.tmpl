package main

import (
	"log"
	"net/http"

	"github.com/toutaio/toutago-cosan-router/pkg/cosan"
	"github.com/toutaio/toutago-fith-renderer"
	"[[ .module_path ]]/handlers"
)

func main() {
	// Initialize template renderer
	renderer, err := fith.New(&fith.Config{
		TemplateDir: "views",
	})
	if err != nil {
		log.Fatalf("Failed to initialize renderer: %v", err)
	}

	// Initialize router
	router := cosan.New()

	// Register routes
	homeHandler := handlers.NewHomeHandler(renderer)
	router.GET("/", homeHandler.Index)

	// Static files
	fileServer := http.FileServer(http.Dir("./static"))
	router.GET("/static/*", func(ctx cosan.Context) error {
		http.StripPrefix("/static/", fileServer).ServeHTTP(ctx.Response(), ctx.Request())
		return nil
	})

	// Start server
	log.Printf("[[ .site_name ]] starting on :%d", [[ .port ]])
	log.Fatal(router.Listen(":[[ .port ]]"))
}
